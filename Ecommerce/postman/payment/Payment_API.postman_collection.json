{
  "info": {
    "name": "Payment APIs - MoMo Web Payment",
    "description": "MoMo Web Payment Integration APIs for E-commerce",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Login - Buyer1",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.environment.set('token', jsonData.data.accessToken);",
                  "    pm.environment.set('username', 'buyer1');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\": \"buyer1\", \"password\": \"buyer123\"}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "login"
              ]
            }
          }
        },
        {
          "name": "Login - Seller1",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.environment.set('token', jsonData.data.accessToken);",
                  "    pm.environment.set('username', 'seller1');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\": \"seller1\", \"password\": \"seller123\"}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "login"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Payment - Create",
      "item": [
        {
          "name": "Create MoMo Web Payment - Valid",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Response has payUrl', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('success', true);",
                  "    pm.expect(jsonData.data).to.have.property('payUrl');",
                  "    pm.expect(jsonData.data.payUrl).to.include('pay.momo.vn');",
                  "});",
                  "pm.test('Response has required fields', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('orderId');",
                  "    pm.expect(jsonData.data).to.have.property('requestId');",
                  "    pm.expect(jsonData.data).to.have.property('amount');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"orderId\": 1, \"orderInfo\": \"Thanh toán đơn hàng #1\"}"
            },
            "url": {
              "raw": "{{base_url}}/api/payment/momo/create",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "payment",
                "momo",
                "create"
              ]
            }
          }
        },
        {
          "name": "Create MoMo Web Payment - Invalid Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "pm.test('Error message for invalid order', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('success', false);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"orderId\": 99999, \"orderInfo\": \"Invalid order\"}"
            },
            "url": {
              "raw": "{{base_url}}/api/payment/momo/create",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "payment",
                "momo",
                "create"
              ]
            }
          }
        },
        {
          "name": "Create MoMo Web Payment - No Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"orderId\": 1, \"orderInfo\": \"Test payment\"}"
            },
            "url": {
              "raw": "{{base_url}}/api/payment/momo/create",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "payment",
                "momo",
                "create"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Payment - Status",
      "item": [
        {
          "name": "Check Payment Status - Valid Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Response has payment status', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('success', true);",
                  "    pm.expect(jsonData.data).to.have.property('orderId');",
                  "    pm.expect(jsonData.data).to.have.property('hasSuccessfulPayment');",
                  "    pm.expect(jsonData.data).to.have.property('paymentStatus');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/payment/momo/status/1",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "payment",
                "momo",
                "status",
                "1"
              ]
            }
          }
        },
        {
          "name": "Check Payment Status - Invalid Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/payment/momo/status/99999",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "payment",
                "momo",
                "status",
                "99999"
              ]
            }
          }
        },
        {
          "name": "Check Payment Status - No Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/payment/momo/status/1",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "payment",
                "momo",
                "status",
                "1"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Payment - Callback",
      "item": [
        {
          "name": "MoMo Callback - Payment Success",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Callback processed successfully', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('success', true);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"partnerCode\":\"MOMOBKUN20180529\",\"orderId\":\"ORD-1-UUID\",\"requestId\":\"REQ-123\",\"amount\":100000,\"orderInfo\":\"Thanh toán đơn hàng #1\",\"orderType\":\"momo_wallet\",\"transId\":\"12345678\",\"resultCode\":0,\"message\":\"Successful\",\"payType\":\"web\",\"responseTime\":1640995200000,\"extraData\":\"\",\"signature\":\"signature_here\"}"
            },
            "url": {
              "raw": "{{base_url}}/api/payment/momo/callback",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "payment",
                "momo",
                "callback"
              ]
            }
          }
        },
        {
          "name": "MoMo Callback - Payment Failed",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"partnerCode\":\"MOMOBKUN20180529\",\"orderId\":\"ORD-1-UUID\",\"requestId\":\"REQ-123\",\"amount\":100000,\"orderInfo\":\"Thanh toán đơn hàng #1\",\"orderType\":\"momo_wallet\",\"transId\":\"12345678\",\"resultCode\":1,\"message\":\"Failed\",\"payType\":\"web\",\"responseTime\":1640995200000,\"extraData\":\"\",\"signature\":\"signature_here\"}"
            },
            "url": {
              "raw": "{{base_url}}/api/payment/momo/callback",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "payment",
                "momo",
                "callback"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Payment - Return",
      "item": [
        {
          "name": "MoMo Return - Success",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/payment/momo/return?orderId=ORD-1-UUID&resultCode=0&message=Successful",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "payment",
                "momo",
                "return"
              ],
              "query": [
                {
                  "key": "orderId",
                  "value": "ORD-1-UUID"
                },
                {
                  "key": "resultCode",
                  "value": "0"
                },
                {
                  "key": "message",
                  "value": "Successful"
                }
              ]
            }
          }
        },
        {
          "name": "MoMo Return - Failed",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/payment/momo/return?orderId=ORD-1-UUID&resultCode=1&message=Failed",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "payment",
                "momo",
                "return"
              ],
              "query": [
                {
                  "key": "orderId",
                  "value": "ORD-1-UUID"
                },
                {
                  "key": "resultCode",
                  "value": "1"
                },
                {
                  "key": "message",
                  "value": "Failed"
                }
              ]
            }
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080"
    },
    {
      "key": "token",
      "value": ""
    },
    {
      "key": "orderId",
      "value": "1"
    }
  ]
}